---
title: "Datasamling"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, include = FALSE)
suppressPackageStartupMessages({
library(PxWebApiData)
library(tidyverse)
library(lubridate)
})
```

```{r knr}
# Vector med relevante kommunenummer
load("knr.Rdata")
```

```{r Moenster}
# Legger inn regex mønster
moenster <- '\\s*\\([\\d\\s-]*\\d*\\)\\s*$'
```

# 1a. Sysselsatte Etter Arbeidssted

```{r}
syssel_arb <- ApiData(
  urlToData = "07984",
  Region = knr,
  ContentsCode = "SysselsatteArb",
  NACE2007 = TRUE,
  Alder = "15-74",
  Kjonn = "0",
  Tid = c(
    as.character(2008:2020)))
```

```{r}
syssel_arb <- syssel_arb$dataset %>% 
  tibble() %>% 
  rename(
    knr = Region,
    aar = Tid)
```

```{r}
syssel_arb <- syssel_arb %>% 
  select(-NAstatus)
```

```{r}
syssel_arb <- syssel_arb %>% 
  pivot_wider(
    names_from = NACE2007,
    values_from = value)
```

```{r}
names(syssel_arb)[[1]] <- "knr"
```

```{r}
syssel_arb <- syssel_arb %>%
  filter(
    knr %in% c(1106, 1135, 1145, 1146, 1149, 1151, 1160, 1211, 4611, 1216, 4612, 1219, 4613, 1221, 4614, 1222, 4615, 1223, 4616, 1224, 4617, 1228, 1231, 4618))
```

**Problem Her** Skal endre knr til navn, 1106 til Haugesund, osv.

```{r}
syssel_arb <- syssel_arb %>% 
  mutate(
    Kjonn = fct_recode(Kjonn,
                     "0" = "Begge Kjønn")
  )
```

# 1b. Sysselsatte Etter Bosted

```{r}
syssel_bos <- ApiData(
  urlToData = "07984",
  Region = knr,
  ContentsCode = "Sysselsatte",
  NACE2007 = TRUE,
  Alder = "15-74",
  Kjonn = "0",
  Tid = c(
    as.character(2008:2020)))
```

```{r}
syssel_bos <- syssel_bos$dataset %>% 
  tibble() %>% 
  rename(
    knr = Region,
    aar = Tid)
```

```{r}
syssel_bos <- syssel_bos %>% 
  pivot_wider(
    names_from = NACE2007,
    values_from = value)
```

```{r}
names(syssel_bos)[[1]] <- "knr"
```

```{r}
syssel_bos <- syssel_bos %>%
  filter(
    knr %in% c(1106, 1135, 1145, 1146, 1149, 1151, 1160, 1211, 4611, 1216, 4612, 1219, 4613, 1221, 4614, 1222, 4615, 1223, 4616, 1224, 4617, 1228, 1231, 4618))
```

```{r}
syssel_bos <- syssel_bos %>% 
  mutate(
    knr = fct_recode(knr,
                     "1106" = "Haugesund")
  )
```






























-