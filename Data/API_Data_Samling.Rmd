---
title: "Datasamling"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, include = FALSE)
suppressPackageStartupMessages({
library(PxWebApiData)
library(tidyverse)
library(lubridate)
})
```

```{r knr}
# Vector med relevante kommunenummer
load("knr.Rdata")
```




# 1a. Sysselsatte Etter Arbeidssted (Kevin & Ola A.)

```{r}
syssel_arb <- ApiData(
  urlToData = "07984",
  Region = knr,
  ContentsCode = "SysselsatteArb",
  NACE2007 = TRUE,
  Alder = "15-74",
  Kjonn = "0",
  Tid = c(
    as.character(2008:2020)))
```

```{r}
syssel_arb <- syssel_arb$dataset %>% 
  tibble() %>% 
  rename(
    knr = Region,
    aar = Tid
) %>% 
    mutate(knavn = syssel_arb$`07984: Sysselsatte per 4. kvartal, etter region, næring (SN2007), kjønn, alder, statistikkvariabel og år`$region)
```

```{r}
syssel_arb <- syssel_arb %>% 
  select(-NAstatus)
```

```{r}
syssel_arb <- syssel_arb %>% 
  pivot_wider(
    names_from = NACE2007,
    values_from = value)
```

```{r}
names(syssel_arb)[[1]] <- "knr"
```

```{r}
syssel_arb <- syssel_arb %>%
  filter(
    knr %in% c(1106, 1135, 1145, 1146, 1149, 1151, 1160, 1211, 4611, 1216, 4612, 1219, 4613, 1221, 4614, 1222, 4615, 1223, 4616, 1224, 4617, 1228, 1231, 4618))
```

```{r Moenster}
# Legger inn regex mønster
moenster <- '\\s*\\([\\d\\s-]*\\d*\\)\\s*$'
```

```{r}
syssel_arb <- syssel_arb %>% 
  mutate(
    knavn = str_replace(knavn, moenster, ""))
```

```{r}
syssel_arb <- syssel_arb %>% 
  mutate(
    Kjonn = fct_recode(Kjonn,
                     "Begge Kjønn" = "0"))
```

```{r}
names(syssel_arb)[[7]] <- "Alle Næringer"
names(syssel_arb)[[8]] <- "Jordbruk, Skogbrug og Fiske"
names(syssel_arb)[[9]] <- "Bergverksdrift og Utvinning"
names(syssel_arb)[[10]] <- "Industri"
names(syssel_arb)[[11]] <- "Elektrisitet, Vann og Renovasjon"
names(syssel_arb)[[12]] <- "Bygge- og Anleggsvirksomhet"
names(syssel_arb)[[13]] <- "Varehandel, Reperasjon av Motorvogner"
names(syssel_arb)[[14]] <- "Transport og Lagring"
names(syssel_arb)[[15]] <- "Overnattings- og Servicevirksomhet"
names(syssel_arb)[[16]] <- "Informasjon og Kommunikasjon"
names(syssel_arb)[[17]] <- "Finansiering og Forsikring"
names(syssel_arb)[[18]] <- "Teknisk Tjenesteyting, Eiendomsdrift"
names(syssel_arb)[[19]] <- "Forretningsmessig Tjenesteyting"
names(syssel_arb)[[20]] <- "Off.Adm, Forsvar, Sosialforsikring"
names(syssel_arb)[[21]] <- "Undervisning"
names(syssel_arb)[[22]] <- "Helse- og Sosialtjenester"
names(syssel_arb)[[23]] <- "Personlig Tjenesteyting"
names(syssel_arb)[[24]] <- "Uoppgitt"
```

# 1b. Sysselsatte Etter Bosted (Kevin & Ola A.)

```{r}
syssel_bos <- ApiData(
  urlToData = "07984",
  Region = knr,
  ContentsCode = "Sysselsatte",
  NACE2007 = TRUE,
  Alder = "15-74",
  Kjonn = "0",
  Tid = c(
    as.character(2008:2020)))
```

```{r}
syssel_bos <- syssel_bos$dataset %>% 
  tibble() %>% 
  rename(
    knr = Region,
    aar = Tid
) %>% 
    mutate(knavn = syssel_bos$`07984: Sysselsatte per 4. kvartal, etter region, næring (SN2007), kjønn, alder, statistikkvariabel og år`$region)
```

```{r}
syssel_bos <- syssel_bos %>% 
  pivot_wider(
    names_from = NACE2007,
    values_from = value)
```

```{r}
names(syssel_bos)[[1]] <- "knr"
```

```{r}
syssel_bos <- syssel_bos %>%
  filter(
    knr %in% c(1106, 1135, 1145, 1146, 1149, 1151, 1160, 1211, 4611, 1216, 4612, 1219, 4613, 1221, 4614, 1222, 4615, 1223, 4616, 1224, 4617, 1228, 1231, 4618))
```

```{r}
syssel_bos <- syssel_bos %>% 
  mutate(
    Kjonn = fct_recode(Kjonn,
                     "Begge Kjønn" = "0"))
```

```{r}
names(syssel_bos)[[7]] <- "Alle Næringer"
names(syssel_bos)[[8]] <- "Jordbruk, Skogbrug og Fiske"
names(syssel_bos)[[9]] <- "Bergverksdrift og Utvinning"
names(syssel_bos)[[10]] <- "Industri"
names(syssel_bos)[[11]] <- "Elektrisitet, Vann og Renovasjon"
names(syssel_bos)[[12]] <- "Bygge- og Anleggsvirksomhet"
names(syssel_bos)[[13]] <- "Varehandel, Reperasjon av Motorvogner"
names(syssel_bos)[[14]] <- "Transport og Lagring"
names(syssel_bos)[[15]] <- "Overnattings- og Servicevirksomhet"
names(syssel_bos)[[16]] <- "Informasjon og Kommunikasjon"
names(syssel_bos)[[17]] <- "Finansiering og Forsikring"
names(syssel_bos)[[18]] <- "Teknisk Tjenesteyting, Eiendomsdrift"
names(syssel_bos)[[19]] <- "Forretningsmessig Tjenesteyting"
names(syssel_bos)[[20]] <- "Off.Adm, Forsvar, Sosialforsikring"
names(syssel_bos)[[21]] <- "Undervisning"
names(syssel_bos)[[22]] <- "Helse- og Sosialtjenester"
names(syssel_bos)[[23]] <- "Personlig Tjenesteyting"
names(syssel_bos)[[24]] <- "Uoppgitt"
```

# 2. Mål for Beskrivelse av Næringsstrukturen



























-