---
title: "Datasamling"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, include = FALSE)
suppressPackageStartupMessages({
library(PxWebApiData)
library(tidyverse)
library(lubridate)
})
```

```{r knr}
# Vector med relevante kommunenummer
load("knr.Rdata")
```

```{r Moenster}
# Legger inn regex m√∏nster
moenster <- '\\s*\\([\\d\\s-]*\\d*\\)\\s*$'
```

# 1. Sysselsatte Etter Arbeidssted

```{r}
syssel_raw <- ApiData(
  urlToData = "07984",
  Region = knr,
  ContentsCode = "SysselsatteArb",
  NACE2007 = TRUE,
  Alder = "15-74",
  Kjonn = TRUE,
  Tid = c(
    as.character(2008:2020)))
```

```{r}
syssel_raw <- syssel_raw$dataset %>% 
  tibble() %>% 
  rename(
    knr = Region,
    aar = Tid)
```

```{r}
syssel_raw <- syssel_raw %>% 
  pivot_wider(
    names_from = NACE2007,
    values_from = value)
```

Problem under her:

```{r}
names(syssel_raw)[[1]] <- "knr"
```

```{r}
syssel_raw <- syssel_raw %>%
  filter(knr == "1106, 1135, 1145, 1146, 1149, 1151, 1160, 1211, 4611, 1216, 4612, 1219, 4613, 1221, 4614, 1222, 4615, 1223, 4616, 1224, 4617, 1228, 1231, 4618")
```




```{r}
syssel_raw <- syssel_raw %>%
  filter(c("1106", "1135", "1145", "1146", "1149", "1151", "1160", "1211", "4611", "1216", "4612", "1219", "4613", "1221", "4614", "1222", "4615", "1223", "4616", "1224", "4617", "1228", "1231", "4618"))
```


```{r}
syssel_raw$knr <- as.numeric(syssel_raw$knr)
```

```{r}
syssel <- syssel %>% 
  mutate(
    knavn = str_replace(knavn, moenster, ""))
```

